<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tienda de Regalos</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <a href="index.html" style="color:white; text-decoration:none;">â¬… Volver</a>
        <h1>Tienda</h1>
        <span class="coin-balance">ðŸª™ <span class="coin-balance-display">...</span></span>
    </header>

    <main>
        <div id="shop-container" class="grid-container">
            <p>Cargando tienda...</p>
        </div>
    </main>

    <script src="js/app.js"></script>
    <script>
        // LÃ³gica especÃ­fica de la tienda
        document.addEventListener('DOMContentLoaded', () => {
            fetch('data/shop.json')
                .then(res => res.json())
                .then(items => renderShop(items))
                .catch(err => console.error("Error cargando tienda", err));
        });

        function renderShop(items) {
            const container = document.getElementById('shop-container');
            container.innerHTML = '';
            
            items.forEach(item => {
                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `
                    <div style="font-size: 3rem;">${item.image}</div>
                    <h3>${item.name}</h3>
                    <p>${item.description}</p>
                    <p><strong>Precio: ${item.price}</strong></p>
                    <button onclick="buyItem(${item.id}, '${item.name}', ${item.price})">Canjear</button>
                `;
                container.appendChild(card);
            });
        }

        function buyItem(id, name, price) {
            if(!confirm(`Â¿Seguro que quieres gastar ${price} monedas en "${name}"?`)) return;

            if(spendCoins(price)) {
                // Registrar compra
                currentState.inventory.push({
                    itemId: id,
                    name: name,
                    date: new Date().toISOString()
                });
                saveState();
                
                // Generar Recibo
                downloadReceipt(name, price);

                // Notificar vÃ­a Mailto
                // NOTA DE SEGURIDAD: EmailJS es mejor para ocultar emails, pero requiere backend/api keys.
                // Mailto es seguro y simple para proyectos estÃ¡ticos.
                const subject = encodeURIComponent(`Canje de Regalo: ${name}`);
                const body = encodeURIComponent(`Hola! He canjeado mis monedas por: ${name}.\n\nFecha: ${new Date().toLocaleString()}`);
                window.location.href = `mailto:tu-email@ejemplo.com?subject=${subject}&body=${body}`;
            } else {
                alert("No tienes suficientes monedas :(");
            }
        }

        function downloadReceipt(itemName, cost) {
            const receipt = `RECIBO DE CANJE\n----------------\nItem: ${itemName}\nCosto: ${cost}\nFecha: ${new Date().toLocaleString()}\n\nÂ¡Gracias por jugar!`;
            const blob = new Blob([receipt], {type: "text/plain"});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `recibo_${itemName.replace(/\s/g, '_')}.txt`;
            a.click();
        }
    </script>
</body>
</html>
